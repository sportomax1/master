<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repository Explorer - sportomax1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0d1117 0%, #161b22 100%);
            color: #e6edf3;
            min-height: 100vh;
            line-height: 1.6;
        }

        .header {
            background: rgba(33, 38, 45, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #30363d;
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            color: #58a6ff;
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: #8b949e;
            font-size: 1rem;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #e6edf3;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #8b949e;
            font-size: 1rem;
        }

        .mode-toggle {
            display: flex;
            background: #21262d;
            border-radius: 8px;
            border: 1px solid #30363d;
            overflow: hidden;
            margin-right: auto;
        }

        .mode-toggle button {
            padding: 0.75rem 1.25rem;
            background: transparent;
            border: none;
            color: #8b949e;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .mode-toggle button.active {
            background: linear-gradient(135deg, #7c3aed, #58a6ff);
            color: white;
            box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);
        }

        .mode-toggle button:hover:not(.active) {
            background: #30363d;
            color: #e6edf3;
        }

        .view-toggle {
            display: flex;
            background: #21262d;
            border-radius: 8px;
            border: 1px solid #30363d;
            overflow: hidden;
        }

        .view-toggle button {
            padding: 0.75rem 1rem;
            background: transparent;
            border: none;
            color: #8b949e;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .view-toggle button.active {
            background: #58a6ff;
            color: white;
        }

        .view-toggle button:hover:not(.active) {
            background: #30363d;
            color: #e6edf3;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            color: #8b949e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .repo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .repo-card {
            background: rgba(33, 38, 45, 0.8);
            border: 1px solid #30363d;
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .repo-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #58a6ff, #7c3aed);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .repo-card:hover {
            transform: translateY(-2px);
            border-color: #58a6ff;
            box-shadow: 0 8px 30px rgba(88, 166, 255, 0.1);
        }

        .repo-card:hover::before {
            transform: scaleX(1);
        }

        .repo-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .repo-icon {
            font-size: 1.2rem;
        }

        .repo-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #58a6ff;
            text-decoration: none;
        }

        .repo-description {
            color: #8b949e;
            margin-bottom: 1rem;
            font-size: 0.95rem;
        }

        .repo-stats {
            display: flex;
            gap: 1rem;
            font-size: 0.85rem;
            color: #8b949e;
            margin-bottom: 1rem;
        }

        .repo-stat {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .repo-dates {
            font-size: 0.8rem;
            color: #656d76;
            border-top: 1px solid #30363d;
            padding-top: 0.75rem;
        }

        .file-browser {
            background: rgba(33, 38, 45, 0.8);
            border: 1px solid #30363d;
            border-radius: 12px;
            margin-top: 1rem;
            overflow: hidden;
        }

        .file-browser-header {
            background: #30363d;
            padding: 1rem;
            border-bottom: 1px solid #21262d;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #8b949e;
            font-size: 0.9rem;
        }

        .breadcrumb-item {
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .breadcrumb-item:hover {
            color: #58a6ff;
        }

        .file-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #30363d;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-item:hover {
            background: rgba(88, 166, 255, 0.1);
        }

        .file-item.html-file {
            background: rgba(255, 165, 0, 0.1);
            border-left: 3px solid #ffa500;
        }

        .file-icon {
            font-size: 1rem;
            width: 20px;
            text-align: center;
        }

        .file-name {
            flex: 1;
            font-size: 0.95rem;
        }

        .file-meta {
            font-size: 0.8rem;
            color: #8b949e;
            text-align: right;
        }

        .hidden {
            display: none;
        }

        .error {
            background: rgba(248, 81, 73, 0.1);
            border: 1px solid rgba(248, 81, 73, 0.3);
            color: #f85149;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .no-results {
            text-align: center;
            padding: 3rem;
            color: #8b949e;
            font-size: 1.1rem;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #21262d;
        }

        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        .html-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
        }

        .html-file-card {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-left: 4px solid #ffa500;
            border-radius: 8px;
            padding: 1.25rem;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .html-file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #ffa500, #ff6b35);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .html-file-card:hover {
            transform: translateY(-2px);
            border-color: #ffa500;
            box-shadow: 0 8px 25px rgba(255, 165, 0, 0.2);
            background: rgba(255, 165, 0, 0.15);
        }

        .html-file-card:hover::before {
            transform: scaleX(1);
        }

        .html-file-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .html-file-icon {
            font-size: 1.5rem;
            color: #ffa500;
        }

        .html-file-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #e6edf3;
            word-break: break-word;
        }

        .html-file-repo {
            font-size: 0.85rem;
            color: #58a6ff;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .html-file-path {
            font-size: 0.8rem;
            color: #8b949e;
            margin-bottom: 0.75rem;
            font-family: 'Courier New', monospace;
            background: rgba(33, 38, 45, 0.8);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .html-file-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #8b949e;
            border-top: 1px solid rgba(255, 165, 0, 0.2);
            padding-top: 0.75rem;
        }

        .html-file-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-button {
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .launch-button {
            background: linear-gradient(135deg, #ffa500, #ff6b35);
            color: white;
        }

        .launch-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);
        }

        .code-button {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
        }

        .code-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(46, 160, 67, 0.4);
        }

        .code-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(5px);
        }

        .code-modal-content {
            background: #0d1117;
            margin: 2% auto;
            padding: 0;
            border: 1px solid #30363d;
            border-radius: 12px;
            width: 95%;
            height: 90%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        .code-modal-header {
            background: linear-gradient(135deg, #21262d 0%, #30363d 100%);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #30363d;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .code-modal-title {
            color: #58a6ff;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .code-modal-close {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .code-modal-close:hover {
            background: #30363d;
            color: #e6edf3;
            border-color: #58a6ff;
        }

        .code-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .code-actions {
            background: #161b22;
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid #30363d;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .code-info {
            flex: 1;
            font-size: 0.85rem;
            color: #8b949e;
        }

        .copy-button {
            background: linear-gradient(135deg, #7c3aed, #58a6ff);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.4);
        }

        .code-display {
            flex: 1;
            overflow: auto;
            background: #0d1117;
            font-family: 'Courier New', 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .code-display pre {
            margin: 0;
            padding: 1.5rem;
            color: #e6edf3;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: #8b949e;
            font-size: 1.1rem;
        }

        /* Syntax highlighting */
        .code-display .tag { color: #7ee787; }
        .code-display .attr-name { color: #79c0ff; }
        .code-display .attr-value { color: #a5d6ff; }
        .code-display .comment { color: #8b949e; font-style: italic; }
        .code-display .doctype { color: #f0883e; }
        .code-display .string { color: #a5d6ff; }

        .token-btn {
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .token-btn:hover {
            background: #30363d;
            color: #e6edf3;
            border-color: #58a6ff;
        }

        .token-btn.has-token {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
            border-color: #2ea043;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #21262d 0%, #30363d 100%);
            margin: 10% auto;
            padding: 2rem;
            border: 1px solid #30363d;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal h3 {
            color: #58a6ff;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .modal p {
            color: #8b949e;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .modal input {
            width: 100%;
            padding: 0.75rem;
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            color: #e6edf3;
            font-size: 1rem;
            margin-bottom: 1.5rem;
            font-family: 'Courier New', monospace;
        }

        .modal input:focus {
            outline: none;
            border-color: #58a6ff;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1);
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: linear-gradient(135deg, #238636, #2ea043);
            color: white;
        }

        .modal-btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(46, 160, 67, 0.3);
        }

        .modal-btn.secondary {
            background: #21262d;
            color: #8b949e;
            border: 1px solid #30363d;
        }

        .modal-btn.secondary:hover {
            background: #30363d;
            color: #e6edf3;
        }

        .rate-limit-info {
            background: rgba(88, 166, 255, 0.1);
            border: 1px solid rgba(88, 166, 255, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .rate-limit-info h4 {
            color: #58a6ff;
            margin-bottom: 0.5rem;
        }

        .rate-limit-info p {
            color: #8b949e;
            margin: 0;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }

            .search-box {
                min-width: unset;
            }

            .repo-grid, .html-grid {
                grid-template-columns: 1fr;
            }

            .header {
                padding: 1rem;
            }

            .container {
                padding: 1rem;
            }

            .mode-toggle {
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ GitHub Repository Explorer</h1>
        <p>Exploring repositories for <strong>sportomax1</strong></p>
        
        <div class="controls">
            <div class="mode-toggle">
                <button id="repoMode" class="active">üìä Repository Manager</button>
                <button id="htmlMode">üåê HTML Web Viewer</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search repositories and files...">
            </div>
            
            <div class="view-toggle" id="viewToggle">
                <button id="treeView" class="active">üå≥ Tree View</button>
                <button id="listView">üìÑ List View</button>
            </div>
            
            <button id="tokenBtn" class="token-btn" onclick="showTokenDialog()">üîë API Token</button>
        </div>
    </div>

    <div class="container">
        <div id="loading" class="loading">
            üîÑ Loading repositories...
        </div>
        
        <div id="error" class="error hidden">
            ‚ùå Error loading repositories. Please check your internet connection and try again.
        </div>

        <div id="repoContainer" class="hidden">
            <div id="repoGrid" class="repo-grid"></div>
        </div>

        <div id="htmlContainer" class="hidden">
            <div id="htmlGrid" class="html-grid"></div>
        </div>

        <div id="noResults" class="no-results hidden">
            üîç No repositories or files found matching your search.
        </div>
    </div>

    <!-- Code Viewer Modal -->
    <div id="codeModal" class="code-modal">
        <div class="code-modal-content">
            <div class="code-modal-header">
                <div class="code-modal-title">
                    <span>üìÑ</span>
                    <span id="codeFileName">Loading...</span>
                </div>
                <button class="code-modal-close" onclick="closeCodeModal()">‚úï Close</button>
            </div>
            <div class="code-content">
                <div class="code-actions">
                    <div class="code-info" id="codeInfo">Loading file...</div>
                    <button class="copy-button" onclick="copyCodeToClipboard()">üìã Copy Code</button>
                </div>
                <div class="code-display" id="codeDisplay">
                    <div class="code-loading">üîÑ Loading HTML code...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Token Modal -->
    <div id="tokenModal" class="modal">
        <div class="modal-content">
            <h3>üîë GitHub API Token</h3>
            
            <div class="rate-limit-info">
                <h4>Rate Limit Information</h4>
                <p><strong>Without token:</strong> 60 requests per hour</p>
                <p><strong>With token:</strong> 5,000 requests per hour</p>
            </div>
            
            <p><strong>üéØ GitHub Token Benefits:</strong><br>
            ‚Ä¢ Scan ALL your repositories for HTML files<br>
            ‚Ä¢ 5,000 API requests per hour (vs 60 without)<br>
            ‚Ä¢ No rate limit interruptions<br>
            ‚Ä¢ Faster repository browsing</p>
            
            <p><strong>üîí Privacy:</strong> Token is stored locally in your browser only.</p>
            
            <p><strong>üìù To create a token:</strong><br>
            1. Go to <a href="https://github.com/settings/tokens" target="_blank" style="color: #58a6ff;">GitHub ‚Üí Settings ‚Üí Personal Access Tokens</a><br>
            2. Generate new token (classic)<br>
            3. Select "public_repo" scope<br>
            4. Copy the token and paste it below</p>
            
            <input type="password" id="tokenInput" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" />
            
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="closeTokenDialog()">Cancel</button>
                <button class="modal-btn primary" onclick="saveToken()">Save Token</button>
                <button class="modal-btn secondary" onclick="clearToken()">Clear Token</button>
            </div>
        </div>
    </div>

    <script>
        // GitHub API configuration
        const GITHUB_USERNAME = 'sportomax1';
        const GITHUB_API_BASE = 'https://api.github.com';
        
        // GitHub token for higher rate limits (optional)
        let githubToken = localStorage.getItem('github_token') || '';
        
        // Application state
        let repositories = [];
        let currentMode = 'repo'; // 'repo' or 'html'
        let currentView = 'tree';
        let searchTerm = '';
        let expandedRepos = new Set();
        let htmlFiles = [];
        let rateLimitExceeded = false;

        // DOM elements
        const loadingEl = document.getElementById('loading');
        const errorEl = document.getElementById('error');
        const repoContainer = document.getElementById('repoContainer');
        const repoGrid = document.getElementById('repoGrid');
        const htmlContainer = document.getElementById('htmlContainer');
        const htmlGrid = document.getElementById('htmlGrid');
        const noResultsEl = document.getElementById('noResults');
        const searchInput = document.getElementById('searchInput');
        const treeViewBtn = document.getElementById('treeView');
        const listViewBtn = document.getElementById('listView');
        const repoModeBtn = document.getElementById('repoMode');
        const htmlModeBtn = document.getElementById('htmlMode');
        const viewToggle = document.getElementById('viewToggle');

        // Initialize the application
        async function init() {
            setupEventListeners();
            await loadRepositories();
        }

        // Setup event listeners
        function setupEventListeners() {
            searchInput.addEventListener('input', handleSearch);
            treeViewBtn.addEventListener('click', () => switchView('tree'));
            listViewBtn.addEventListener('click', () => switchView('list'));
            repoModeBtn.addEventListener('click', () => switchMode('repo'));
            htmlModeBtn.addEventListener('click', () => switchMode('html'));
            
            // Update token button appearance
            updateTokenButton();
            
            // Close modal when clicking outside
            window.addEventListener('click', (event) => {
                const tokenModal = document.getElementById('tokenModal');
                const codeModal = document.getElementById('codeModal');
                
                if (event.target === tokenModal) {
                    closeTokenDialog();
                }
                if (event.target === codeModal) {
                    closeCodeModal();
                }
            });

            // Close modals with Escape key
            document.addEventListener('keydown', (event) => {
                if (event.key === 'Escape') {
                    closeTokenDialog();
                    closeCodeModal();
                }
            });
        }

        // Update token button appearance
        function updateTokenButton() {
            const tokenBtn = document.getElementById('tokenBtn');
            if (githubToken) {
                tokenBtn.classList.add('has-token');
                tokenBtn.innerHTML = 'üîë Token Active';
            } else {
                tokenBtn.classList.remove('has-token');
                tokenBtn.innerHTML = 'üîë API Token';
            }
        }

        // Show token dialog
        function showTokenDialog() {
            const modal = document.getElementById('tokenModal');
            const input = document.getElementById('tokenInput');
            input.value = githubToken;
            modal.style.display = 'block';
        }

        // Close token dialog
        function closeTokenDialog() {
            const modal = document.getElementById('tokenModal');
            modal.style.display = 'none';
        }

        // Save token
        async function saveToken() {
            const input = document.getElementById('tokenInput');
            const token = input.value.trim();
            
            if (token) {
                githubToken = token;
                localStorage.setItem('github_token', token);
            }
            
            updateTokenButton();
            closeTokenDialog();
            
            // Reset rate limit state
            rateLimitExceeded = false;
            
            // Reload repositories with new token and scan all for HTML files
            showLoading(true);
            await loadRepositories();
            showLoading(false);
        }

        // Clear token
        function clearToken() {
            githubToken = '';
            localStorage.removeItem('github_token');
            updateTokenButton();
            closeTokenDialog();
        }

        // View HTML code in modal
        async function viewHtmlCode(downloadUrl, fileName, repoName, filePath) {
            const modal = document.getElementById('codeModal');
            const fileNameEl = document.getElementById('codeFileName');
            const codeInfoEl = document.getElementById('codeInfo');
            const codeDisplayEl = document.getElementById('codeDisplay');
            
            // Show modal and reset content
            modal.style.display = 'block';
            fileNameEl.textContent = fileName;
            codeInfoEl.textContent = `${repoName}/${filePath}`;
            codeDisplayEl.innerHTML = '<div class="code-loading">üîÑ Loading HTML code...</div>';
            
            try {
                const response = await fetch(downloadUrl, {
                    headers: getApiHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to load file: ${response.status}`);
                }
                
                const htmlContent = await response.text();
                const highlightedCode = highlightHtmlSyntax(htmlContent);
                
                codeDisplayEl.innerHTML = `<pre>${highlightedCode}</pre>`;
                codeInfoEl.textContent = `${repoName}/${filePath} ‚Ä¢ ${formatFileSize(htmlContent.length)} ‚Ä¢ ${htmlContent.split('\n').length} lines`;
                
                // Store content for copying
                window.currentCodeContent = htmlContent;
                
            } catch (error) {
                console.error('Error loading HTML code:', error);
                codeDisplayEl.innerHTML = `<div class="code-loading" style="color: #f85149;">‚ùå Error loading code: ${error.message}</div>`;
            }
        }

        // Close code modal
        function closeCodeModal() {
            const modal = document.getElementById('codeModal');
            modal.style.display = 'none';
        }

        // Copy code to clipboard
        async function copyCodeToClipboard() {
            if (!window.currentCodeContent) return;
            
            try {
                await navigator.clipboard.writeText(window.currentCodeContent);
                
                // Show feedback
                const copyBtn = document.querySelector('.copy-button');
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = '‚úÖ Copied!';
                copyBtn.style.background = 'linear-gradient(135deg, #238636, #2ea043)';
                
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                    copyBtn.style.background = 'linear-gradient(135deg, #7c3aed, #58a6ff)';
                }, 2000);
                
            } catch (err) {
                console.error('Failed to copy code:', err);
                alert('Failed to copy code to clipboard');
            }
        }

        // Simple HTML syntax highlighting
        function highlightHtmlSyntax(html) {
            return html
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/(&lt;!DOCTYPE[^&]*&gt;)/g, '<span class="doctype">$1</span>')
                .replace(/(&lt;!--[\s\S]*?--&gt;)/g, '<span class="comment">$1</span>')
                .replace(/(&lt;\/?)([\w-]+)/g, '$1<span class="tag">$2</span>')
                .replace(/([\w-]+)(=)/g, '<span class="attr-name">$1</span>$2')
                .replace(/=("[^"]*"|'[^']*')/g, '=<span class="attr-value">$1</span>');
        }

        // Get API headers with optional token
        function getApiHeaders() {
            const headers = {
                'Accept': 'application/vnd.github.v3+json',
                'User-Agent': 'GitHub-Repo-Explorer'
            };
            
            if (githubToken) {
                headers['Authorization'] = `token ${githubToken}`;
            }
            
            return headers;
        }

        // Load all public repositories
        async function loadRepositories() {
            try {
                showLoading(true);
                const response = await fetch(`${GITHUB_API_BASE}/users/${GITHUB_USERNAME}/repos?type=public&sort=updated&per_page=100`, {
                    headers: getApiHeaders()
                });
                
                if (!response.ok) {
                    if (response.status === 403) {
                        const rateLimitRemaining = response.headers.get('X-RateLimit-Remaining');
                        const rateLimitReset = response.headers.get('X-RateLimit-Reset');
                        const resetTime = rateLimitReset ? new Date(rateLimitReset * 1000).toLocaleTimeString() : 'unknown';
                        
                        throw new Error(`GitHub API rate limit exceeded. ${rateLimitRemaining || 0} requests remaining. Resets at ${resetTime}. Consider adding a GitHub token for higher limits.`);
                    }
                    throw new Error(`GitHub API error: ${response.status}`);
                }

                repositories = await response.json();
                repositories.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
                
                // Only load HTML files if we have a token or if user switches to HTML mode
                // This saves API calls for users without tokens
                if (githubToken) {
                    await loadAllHtmlFiles();
                }
                
                showLoading(false);
                renderCurrentMode();
            } catch (error) {
                console.error('Error loading repositories:', error);
                errorEl.innerHTML = `‚ùå ${error.message}`;
                showError(true);
                showLoading(false);
            }
        }

        // Show/hide loading state
        function showLoading(show) {
            loadingEl.classList.toggle('hidden', !show);
            repoContainer.classList.toggle('hidden', show || currentMode !== 'repo');
            htmlContainer.classList.toggle('hidden', show || currentMode !== 'html');
        }

        // Show/hide error state
        function showError(show) {
            errorEl.classList.toggle('hidden', !show);
        }

        // Switch between repo and html mode
        async function switchMode(mode) {
            currentMode = mode;
            repoModeBtn.classList.toggle('active', mode === 'repo');
            htmlModeBtn.classList.toggle('active', mode === 'html');
            
            // Show/hide view toggle based on mode
            viewToggle.classList.toggle('hidden', mode === 'html');
            
            // Update search placeholder
            searchInput.placeholder = mode === 'repo' 
                ? 'Search repositories and files...' 
                : 'Search HTML files...';
            
            // Load HTML files when switching to HTML mode (if not already loaded)
            if (mode === 'html' && htmlFiles.length === 0 && repositories.length > 0) {
                showLoading(true);
                await loadAllHtmlFiles();
                showLoading(false);
            }
            
            renderCurrentMode();
        }

        // Switch between tree and list view
        function switchView(view) {
            currentView = view;
            treeViewBtn.classList.toggle('active', view === 'tree');
            listViewBtn.classList.toggle('active', view === 'list');
            if (currentMode === 'repo') {
                renderRepositories();
            }
        }

        // Handle search input
        function handleSearch(event) {
            searchTerm = event.target.value.toLowerCase();
            renderCurrentMode();
        }

        // Render current mode
        function renderCurrentMode() {
            if (currentMode === 'repo') {
                repoContainer.classList.remove('hidden');
                htmlContainer.classList.add('hidden');
                renderRepositories();
            } else {
                repoContainer.classList.add('hidden');
                htmlContainer.classList.remove('hidden');
                renderHtmlFiles();
            }
        }

        // Filter repositories based on search term
        function filterRepositories() {
            if (!searchTerm) return repositories;
            
            return repositories.filter(repo => 
                repo.name.toLowerCase().includes(searchTerm) ||
                (repo.description && repo.description.toLowerCase().includes(searchTerm))
            );
        }

        // Render repositories
        function renderRepositories() {
            const filteredRepos = filterRepositories();
            
            if (filteredRepos.length === 0) {
                repoContainer.classList.add('hidden');
                noResultsEl.classList.remove('hidden');
                return;
            }

            repoContainer.classList.remove('hidden');
            noResultsEl.classList.add('hidden');
            
            repoGrid.innerHTML = filteredRepos.map(repo => createRepoCard(repo)).join('');
        }

        // Create repository card HTML
        function createRepoCard(repo) {
            const createdDate = new Date(repo.created_at).toLocaleDateString();
            const updatedDate = new Date(repo.updated_at).toLocaleDateString();
            const isExpanded = expandedRepos.has(repo.name);

            return `
                <div class="repo-card" onclick="toggleRepoExpansion('${repo.name}')">
                    <div class="repo-header">
                        <span class="repo-icon">üìÅ</span>
                        <a href="${repo.html_url}" target="_blank" class="repo-name" onclick="event.stopPropagation()">${repo.name}</a>
                    </div>
                    
                    <div class="repo-description">
                        ${repo.description || 'No description available'}
                    </div>
                    
                    <div class="repo-stats">
                        <div class="repo-stat">
                            <span>‚≠ê</span>
                            <span>${repo.stargazers_count}</span>
                        </div>
                        <div class="repo-stat">
                            <span>üç¥</span>
                            <span>${repo.forks_count}</span>
                        </div>
                        <div class="repo-stat">
                            <span>üëÅÔ∏è</span>
                            <span>${repo.watchers_count}</span>
                        </div>
                        ${repo.language ? `<div class="repo-stat"><span>üíª</span><span>${repo.language}</span></div>` : ''}
                    </div>
                    
                    <div class="repo-dates">
                        <div>üìÖ Created: ${createdDate}</div>
                        <div>üîÑ Updated: ${updatedDate}</div>
                    </div>
                    
                    ${isExpanded ? `<div id="files-${repo.name}" class="file-browser">
                        <div class="file-browser-header">
                            <span>üìÇ</span>
                            <div class="breadcrumb">
                                <span class="breadcrumb-item" onclick="loadRepoContents('${repo.name}', '')">${repo.name}</span>
                            </div>
                        </div>
                        <div class="file-list" id="file-list-${repo.name}">
                            <div class="loading">üîÑ Loading files...</div>
                        </div>
                    </div>` : ''}
                </div>
            `;
        }

        // Toggle repository expansion
        async function toggleRepoExpansion(repoName) {
            if (expandedRepos.has(repoName)) {
                expandedRepos.delete(repoName);
            } else {
                expandedRepos.add(repoName);
                // Load repository contents when expanding
                setTimeout(() => loadRepoContents(repoName, ''), 100);
            }
            renderRepositories();
        }

        // Load repository contents
        async function loadRepoContents(repoName, path = '') {
            const fileListEl = document.getElementById(`file-list-${repoName}`);
            if (!fileListEl) return;

            try {
                fileListEl.innerHTML = '<div class="loading">üîÑ Loading files...</div>';
                
                const url = `${GITHUB_API_BASE}/repos/${GITHUB_USERNAME}/${repoName}/contents/${path}`;
                const response = await fetch(url, {
                    headers: getApiHeaders()
                });
                
                if (!response.ok) {
                    throw new Error(`Failed to load contents: ${response.status}`);
                }

                const contents = await response.json();
                
                // Sort: directories first, then files
                contents.sort((a, b) => {
                    if (a.type === 'dir' && b.type !== 'dir') return -1;
                    if (a.type !== 'dir' && b.type === 'dir') return 1;
                    return a.name.localeCompare(b.name);
                });

                fileListEl.innerHTML = contents.map(item => createFileItem(repoName, item, path)).join('');
                
            } catch (error) {
                console.error('Error loading repository contents:', error);
                fileListEl.innerHTML = '<div class="error">‚ùå Error loading files</div>';
            }
        }

        // Create file item HTML
        function createFileItem(repoName, item, currentPath) {
            const isHtml = item.name.toLowerCase().endsWith('.html');
            const icon = item.type === 'dir' ? 'üìÅ' : (isHtml ? 'üåê' : 'üìÑ');
            const itemClass = isHtml ? 'file-item html-file' : 'file-item';
            
            const onClick = item.type === 'dir' 
                ? `loadRepoContents('${repoName}', '${currentPath ? currentPath + '/' : ''}${item.name}')`
                : isHtml 
                    ? `openHtmlFile('${item.download_url}')`
                    : `openFile('${item.html_url}')`;

            return `
                <div class="${itemClass}" onclick="${onClick}">
                    <span class="file-icon">${icon}</span>
                    <span class="file-name">${item.name}</span>
                    <div class="file-meta">
                        ${item.type === 'file' ? `${formatFileSize(item.size)}` : ''}
                    </div>
                </div>
            `;
        }

        // Launch HTML page with smart URL detection
        function launchHtmlPage(githubPagesUrl, downloadUrl, fileName, repoName) {
            // First try GitHub Pages URL
            const testWindow = window.open(githubPagesUrl, '_blank');
            
            // Check if GitHub Pages is available by testing the URL
            setTimeout(() => {
                fetch(githubPagesUrl, { method: 'HEAD', mode: 'no-cors' })
                    .then(() => {
                        // GitHub Pages URL works, keep it open
                        console.log(`Launched GitHub Pages: ${githubPagesUrl}`);
                    })
                    .catch(() => {
                        // GitHub Pages not available, close and show options
                        if (testWindow) {
                            testWindow.close();
                        }
                        showLaunchOptions(githubPagesUrl, downloadUrl, fileName, repoName);
                    });
            }, 1000);
        }

        // Show launch options when GitHub Pages isn't available
        function showLaunchOptions(githubPagesUrl, downloadUrl, fileName, repoName) {
            const options = [
                `üåê GitHub Pages: ${githubPagesUrl}`,
                `üìÑ Raw File: ${downloadUrl}`,
                `üìÅ GitHub Repository: https://github.com/${GITHUB_USERNAME}/${repoName}`
            ];
            
            const choice = confirm(
                `GitHub Pages might not be enabled for "${repoName}".\n\n` +
                `Choose how to open "${fileName}":\n\n` +
                `OK = Try GitHub Pages anyway\n` +
                `Cancel = Open raw HTML file\n\n` +
                `Note: Enable GitHub Pages in repository settings for proper rendering.`
            );
            
            if (choice) {
                // User chose to try GitHub Pages anyway
                window.open(githubPagesUrl, '_blank');
            } else {
                // User chose raw file
                window.open(downloadUrl, '_blank');
            }
        }

        // Open HTML file in new window (legacy function, now for raw content)
        function openHtmlFile(downloadUrl) {
            window.open(downloadUrl, '_blank');
        }

        // Open regular file in GitHub
        function openFile(htmlUrl) {
            window.open(htmlUrl, '_blank');
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        // Load all HTML files from all repositories
        async function loadAllHtmlFiles() {
            htmlFiles = [];
            let scannedRepos = 0;
            const maxReposToScan = githubToken ? repositories.length : Math.min(10, repositories.length);
            
            // Show progress for users without token
            if (!githubToken) {
                console.log(`Scanning first ${maxReposToScan} repositories for HTML files (without token)`);
            }
            
            for (let i = 0; i < maxReposToScan; i++) {
                const repo = repositories[i];
                try {
                    await findHtmlFilesInRepo(repo.name, '', repo);
                    scannedRepos++;
                } catch (error) {
                    console.log(`Could not scan ${repo.name}:`, error.message);
                    
                    // If we hit rate limit, stop scanning
                    if (error.message.includes('403') || error.message.includes('rate limit')) {
                        rateLimitExceeded = true;
                        break;
                    }
                }
                
                // Add small delay to avoid hitting rate limits too quickly
                if (!githubToken && i < maxReposToScan - 1) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
            }
            
            // Sort HTML files by repository name, then by file name
            htmlFiles.sort((a, b) => {
                if (a.repo !== b.repo) return a.repo.localeCompare(b.repo);
                return a.name.localeCompare(b.name);
            });
            
            console.log(`Found ${htmlFiles.length} HTML files in ${scannedRepos} repositories`);
        }

        // Generate GitHub Pages URL for HTML files
        function generateGithubPagesUrl(repoName, filePath) {
            // GitHub Pages URL format: https://username.github.io/repository/path/file.html
            return `https://${GITHUB_USERNAME}.github.io/${repoName}/${filePath}`;
        }

        // Recursively find HTML files in a repository
        async function findHtmlFilesInRepo(repoName, path = '', repoData) {
            try {
                const url = `${GITHUB_API_BASE}/repos/${GITHUB_USERNAME}/${repoName}/contents/${path}`;
                const response = await fetch(url, {
                    headers: getApiHeaders()
                });
                
                if (!response.ok) return;

                const contents = await response.json();
                
                for (const item of contents) {
                    if (item.type === 'file' && item.name.toLowerCase().endsWith('.html')) {
                        htmlFiles.push({
                            name: item.name,
                            path: item.path,
                            repo: repoName,
                            repoData: repoData,
                            downloadUrl: item.download_url,
                            htmlUrl: item.html_url,
                            githubPagesUrl: generateGithubPagesUrl(repoName, item.path),
                            size: item.size,
                            lastModified: repoData.updated_at
                        });
                    } else if (item.type === 'dir') {
                        // Recursively search directories (limit depth to avoid API limits)
                        if (path.split('/').length < 3) {
                            await findHtmlFilesInRepo(repoName, item.path, repoData);
                        }
                    }
                }
            } catch (error) {
                // Silently handle errors (private repos, API limits, etc.)
            }
        }

        // Filter HTML files based on search term
        function filterHtmlFiles() {
            if (!searchTerm) return htmlFiles;
            
            return htmlFiles.filter(file => 
                file.name.toLowerCase().includes(searchTerm) ||
                file.repo.toLowerCase().includes(searchTerm) ||
                file.path.toLowerCase().includes(searchTerm)
            );
        }

        // Render HTML files
        function renderHtmlFiles() {
            const filteredFiles = filterHtmlFiles();
            
            if (filteredFiles.length === 0) {
                htmlContainer.classList.add('hidden');
                noResultsEl.classList.remove('hidden');
                
                if (rateLimitExceeded && !githubToken) {
                    noResultsEl.innerHTML = `
                        üö´ <strong>Rate limit reached while scanning repositories.</strong><br><br>
                        ${htmlFiles.length > 0 ? `Found ${htmlFiles.length} HTML files before limit was reached.<br><br>` : ''}
                        üí° <strong>Options:</strong><br>
                        ‚Ä¢ Wait for rate limit to reset (resets every hour)<br>
                        ‚Ä¢ Add a GitHub token for 5,000 requests/hour<br>
                        ‚Ä¢ Use Repository Manager mode to browse files manually
                    `;
                } else if (searchTerm) {
                    noResultsEl.innerHTML = 'üîç No HTML files found matching your search.';
                } else if (!githubToken) {
                    noResultsEl.innerHTML = `
                        üåê <strong>Limited scan complete</strong><br><br>
                        Scanned first 10 repositories without GitHub token.<br>
                        Found ${htmlFiles.length} HTML files.<br><br>
                        üí° Add a GitHub token to scan all repositories.
                    `;
                } else {
                    noResultsEl.innerHTML = 'üåê No HTML files found in your repositories.';
                }
                return;
            }

            htmlContainer.classList.remove('hidden');
            noResultsEl.classList.add('hidden');
            
            // Add info header if scanning was limited
            let headerInfo = '';
            if (!githubToken && repositories.length > 10) {
                headerInfo = `
                    <div style="background: rgba(88, 166, 255, 0.1); border: 1px solid rgba(88, 166, 255, 0.3); border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem; text-align: center;">
                        <p style="margin: 0; color: #58a6ff;">
                            üìä Showing HTML files from first 10 repositories (${filteredFiles.length} files)<br>
                            üí° Add GitHub token to scan all ${repositories.length} repositories
                        </p>
                    </div>
                `;
            }
            
            htmlGrid.innerHTML = headerInfo + filteredFiles.map(file => createHtmlFileCard(file)).join('');
        }

        // Create HTML file card
        function createHtmlFileCard(file) {
            const lastModified = new Date(file.lastModified).toLocaleDateString();
            const fileSize = formatFileSize(file.size);
            
            return `
                <div class="html-file-card">
                    <div class="html-file-header">
                        <span class="html-file-icon">üåê</span>
                        <div class="html-file-name">${file.name}</div>
                    </div>
                    
                    <div class="html-file-repo">
                        <span>üìÅ</span>
                        <span>${file.repo}</span>
                    </div>
                    
                    <div class="html-file-path">
                        ${file.path}
                    </div>
                    
                    <div class="html-file-meta">
                        <div>
                            <div>üìÖ ${lastModified}</div>
                            <div>üì¶ ${fileSize}</div>
                        </div>
                        <div class="html-file-actions">
                            <button class="action-button code-button" onclick="viewHtmlCode('${file.downloadUrl}', '${file.name}', '${file.repo}', '${file.path}')">
                                üìÑ View Code
                            </button>
                            <button class="action-button launch-button" onclick="launchHtmlPage('${file.githubPagesUrl}', '${file.downloadUrl}', '${file.name}', '${file.repo}')">
                                üöÄ Launch Web
                            </button>
                        </div>
                        
                        <div class="launch-urls" style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid rgba(255, 165, 0, 0.2); font-size: 0.75rem;">
                            <div style="color: #8b949e; margin-bottom: 0.25rem;">Launch URLs:</div>
                            <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                <a href="${file.githubPagesUrl}" target="_blank" style="color: #58a6ff; text-decoration: none; word-break: break-all;" 
                                   onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">
                                    üåê ${file.githubPagesUrl}
                                </a>
                                <a href="${file.downloadUrl}" target="_blank" style="color: #8b949e; text-decoration: none; word-break: break-all;" 
                                   onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">
                                    üìÑ Raw: ${file.downloadUrl}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>